

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>PyBADS Example 3: Noisy objective function &#8212; PyBADS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_examples/pybads_example_3_noisy_objective';</script>
    <link rel="canonical" href="https://acerbilab.github.io/pybads/_examples/pybads_example_3_noisy_objective.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyBADS Example 4: Noisy objective with user-provided noise estimates" href="pybads_example_4_user_provided_noise.html" />
    <link rel="prev" title="PyBADS Example 2: Non-box constraints" href="pybads_example_2_nonbox_constraints.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">PyBADS</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Getting started</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pybads_example_1_basic_usage.html">PyBADS Example 1: Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="pybads_example_2_nonbox_constraints.html">PyBADS Example 2: Non-box constraints</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">PyBADS Example 3: Noisy objective function</a></li>
<li class="toctree-l2"><a class="reference internal" href="pybads_example_4_user_provided_noise.html">PyBADS Example 4: Noisy objective with user-provided noise estimates</a></li>
<li class="toctree-l2"><a class="reference internal" href="pybads_example_5_extended_usage.html">PyBADS Example 5: Extended usage</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../documentation.html">Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/classes/bads.html"><code class="docutils literal notranslate"><span class="pre">BADS</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/classes/optimize_result.html"><code class="docutils literal notranslate"><span class="pre">OptimizeResult</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/options/bads_options.html">BADS options</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/advanced_docs.html">Advanced documentation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/classes/classes.html">Classes</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/bads.html"><code class="docutils literal notranslate"><span class="pre">BADS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/function_logger.html"><code class="docutils literal notranslate"><span class="pre">FunctionLogger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/iteration_history.html"><code class="docutils literal notranslate"><span class="pre">IterationHistory</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/optimize_result.html"><code class="docutils literal notranslate"><span class="pre">OptimizeResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/options.html"><code class="docutils literal notranslate"><span class="pre">Options</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/parameter_transformer.html"><code class="docutils literal notranslate"><span class="pre">VariableTransformer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/classes/timer.html"><code class="docutils literal notranslate"><span class="pre">Timer</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/functions/functions.html">Functions</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/functions/acquisition_functions.html">Acquisition Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/functions/decorators.html">Decorators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/functions/get_hpd.html"><code class="docutils literal notranslate"><span class="pre">get_hpd</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/options/bads_options.html">BADS options</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../development.html">Instructions for developers and contributors</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about_us.html">About us</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/acerbilab/pybads/main?urlpath=lab/tree/_examples/pybads_example_3_noisy_objective.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/acerbilab/pybads/blob/main/_examples/pybads_example_3_noisy_objective.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/acerbilab/pybads" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/acerbilab/pybads/edit/main/_examples/pybads_example_3_noisy_objective.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/acerbilab/pybads/issues/new?title=Issue%20on%20page%20%2F_examples/pybads_example_3_noisy_objective.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/_examples/pybads_example_3_noisy_objective.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>PyBADS Example 3: Noisy objective function</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#noisy-optimization">0. Noisy optimization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-setup">1. Problem setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-optimization">2. Run the optimization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-and-conclusions">3. Results and conclusions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remarks">Remarks</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pybads-example-3-noisy-objective-function">
<h1>PyBADS Example 3: Noisy objective function<a class="headerlink" href="#pybads-example-3-noisy-objective-function" title="Permalink to this heading">#</a></h1>
<p>In this example, we will show how to run PyBADS on a noisy target.</p>
<p>This notebook is Part 3 of a series of notebooks in which we present various example usages for BADS with the PyBADS package.
The code used in this example is available as a script <a class="reference download internal" download="" href="../_downloads/e438e0f5fc735fbcda36ef39de78ec93/pybads_example_3_noisy_objective.py"><span class="xref download myst">here</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pybads</span> <span class="kn">import</span> <span class="n">BADS</span>
</pre></div>
</div>
</div>
</div>
<section id="noisy-optimization">
<h2>0. Noisy optimization<a class="headerlink" href="#noisy-optimization" title="Permalink to this heading">#</a></h2>
<p>PyBADS is also able to optimize <em>noisy</em> objective functions. A noisy (or stochastic) objective function is an objective that will return different results if evaluated twice at the same point <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>. Conversely, a non-noisy objective function is known as noiseless or deterministic. For example, noisy objectives are common in model fitting when the model is evaluated through simulation (e.g., via sampling aka Monte Carlo methods).</p>
<p>For a noisy objective, PyBADS aims to minimize the <em>expected value</em> of <span class="math notranslate nohighlight">\(f(\mathbf{x})\)</span>:
$<span class="math notranslate nohighlight">\(
\mathbf{x}^\star = \arg\min_{\mathbf{x} \in \mathcal{X} \subseteq \mathbb{R}^D} \mathbb{E}\left[f(\mathbf{x})\right].
\)</span>$</p>
</section>
<section id="problem-setup">
<h2>1. Problem setup<a class="headerlink" href="#problem-setup" title="Permalink to this heading">#</a></h2>
<p>For this example, we take as target a quadratic function and we add i.i.d. Gaussian noise to it (<em>noisy sphere</em>). In a real case, the noise would arise from some stochastic process in the calculation of the target.</p>
<p>We also set here several <code class="docutils literal notranslate"><span class="pre">options</span></code> for the optimization:</p>
<ul class="simple">
<li><p>We tell <code class="docutils literal notranslate"><span class="pre">bads</span></code> that the target is noisy by activating the <code class="docutils literal notranslate"><span class="pre">uncertainty_handling</span></code> option. This is not strictly needed, as <code class="docutils literal notranslate"><span class="pre">bads</span></code> can automatically detect if a target is noisy, but it is good practice to specify.</p></li>
<li><p>We also limit the number of function evaluations with <code class="docutils literal notranslate"><span class="pre">max_fun_evals</span></code>, knowing that this is a simple example. Generally, <code class="docutils literal notranslate"><span class="pre">bads</span></code> will tend to run for longer on noisy problems to better explore the noisy landscape.</p></li>
<li><p>Finally, we tell <code class="docutils literal notranslate"><span class="pre">bads</span></code> to re-evaluate the target at the returned solution with 100 samples via <code class="docutils literal notranslate"><span class="pre">noise_final_samples</span></code> (by default, <code class="docutils literal notranslate"><span class="pre">noise_final_samples</span> <span class="pre">=</span> <span class="pre">10</span></code>, but since our function is inexpensive we can use more evaluations). These evaluations count towards the total budget of function evaluations <code class="docutils literal notranslate"><span class="pre">max_fun_evals</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">noisy_sphere</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple quadratic function with added noise.&quot;&quot;&quot;</span>
    <span class="n">x_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_2d</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">x_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">f</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]);</span>      <span class="c1"># Starting point</span>
<span class="n">lower_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>
<span class="n">upper_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">plausible_lower_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plausible_upper_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;uncertainty_handling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;max_fun_evals&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="s2">&quot;noise_final_samples&quot;</span><span class="p">:</span> <span class="mi">100</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-the-optimization">
<h2>2. Run the optimization<a class="headerlink" href="#run-the-optimization" title="Permalink to this heading">#</a></h2>
<p>We run <code class="docutils literal notranslate"><span class="pre">bads</span></code> with the user-defined <code class="docutils literal notranslate"><span class="pre">options</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bads</span> <span class="o">=</span> <span class="n">BADS</span><span class="p">(</span>
    <span class="n">noisy_sphere</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">,</span> <span class="n">plausible_lower_bounds</span><span class="p">,</span> <span class="n">plausible_upper_bounds</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span>
<span class="p">)</span>
<span class="n">optimize_result</span> <span class="o">=</span> <span class="n">bads</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Beginning optimization of a STOCHASTIC objective function

 Iteration    f-count      E[f(x)]        SD[f(x)]           MeshScale          Method              Actions
     0           1         17.0467             nan               1                                  
     0          33       -0.573104             nan               1          Initial mesh            Initial points
     0          37       -0.573104               1             0.5          Refine grid             Train
     1          45       -0.573104               1            0.25          Refine grid             Train
     2          46      -0.0875221        0.236985            0.25      Successful search (ES-wcm)        
     2          47       -0.133904        0.229856            0.25      Incremental search (ES-wcm)        
     2          51        -0.14124        0.205711            0.25      Incremental search (ES-ell)        
     2          53       -0.184658        0.196127            0.25      Incremental search (ES-ell)        
     2          57       -0.184658        0.196127           0.125          Refine grid             Train
     3          58       -0.113416        0.181841           0.125      Incremental search (ES-wcm)        
     3          59       -0.143424         0.17853           0.125      Incremental search (ES-wcm)        
     3          60       -0.153414        0.175473           0.125      Incremental search (ES-wcm)        
     3          65       -0.153414        0.175473          0.0625          Refine grid             
     4          73       -0.202447        0.162169         0.03125          Refine grid             
     5          77      -0.0930382        0.136617         0.03125      Successful search (ES-ell)        
     5          78      -0.0993084        0.139908         0.03125      Successful search (ES-ell)        
     5          79       -0.108523        0.138428         0.03125      Successful search (ES-ell)        
     5          80       -0.110481        0.137001         0.03125      Incremental search (ES-ell)        
     5          81       -0.116493        0.135622         0.03125      Successful search (ES-ell)        
     5          82       -0.119346        0.134247         0.03125      Incremental search (ES-wcm)        
     5          83       -0.126705        0.132937         0.03125      Successful search (ES-wcm)        
     5          93       -0.126705        0.132937        0.015625          Refine grid             Train
     6          94       -0.112421        0.115326        0.015625      Successful search (ES-ell)        
     6          95       -0.138253        0.114425        0.015625      Successful search (ES-wcm)        
     6         105       -0.138253        0.114425       0.0078125          Refine grid             
     7         106       -0.108284        0.103892       0.0078125      Incremental search (ES-wcm)        
     7         111       -0.110376        0.101127        0.015625        Successful poll           Train
     8         119      -0.0915521       0.0990537      0.00390625          Refine grid             Train
     9         127      -0.0813753       0.0944134     0.000976562          Refine grid             Train
    10         131       -0.037847       0.0890104     0.000976562      Successful search (ES-ell)        
    10         134      -0.0528433        0.089216     0.000976562      Successful search (ES-ell)        
    10         135      -0.0639539       0.0887966     0.000976562      Successful search (ES-ell)        
    10         143      -0.0639539       0.0887966     0.000488281          Refine grid             
    11         145      -0.0383948        0.084316     0.000488281      Successful search (ES-ell)        
    11         146      -0.0420733       0.0839543     0.000488281      Successful search (ES-ell)        
    11         147      -0.0479433       0.0835921     0.000488281      Successful search (ES-ell)        
    11         150      -0.0501619       0.0825213     0.000488281      Successful search (ES-wcm)        
    11         152      -0.0640664       0.0818386     0.000488281      Successful search (ES-wcm)        
    11         153      -0.0722405       0.0815143     0.000488281      Successful search (ES-wcm)        
    11         163      -0.0722405       0.0815143     0.000244141          Refine grid             
Optimization terminated: change in the function value less than options[&#39;tol_fun&#39;].
Estimated function value at minimum: -0.04111370566211175 ± 0.09385579705318894 (mean ± SEM from 100 samples)
</pre></div>
</div>
</div>
</div>
</section>
<section id="results-and-conclusions">
<h2>3. Results and conclusions<a class="headerlink" href="#results-and-conclusions" title="Permalink to this heading">#</a></h2>
<p>First, note that in this case <code class="docutils literal notranslate"><span class="pre">optimize_result['fval']</span></code> is the <em>estimated</em> function value at <code class="docutils literal notranslate"><span class="pre">optimize_result['x']</span></code>, obtained by taking the mean of <code class="docutils literal notranslate"><span class="pre">options['noise_final_samples']</span></code> target evaluations (<code class="docutils literal notranslate"><span class="pre">noise_final_samples</span> <span class="pre">=</span> <span class="pre">10</span></code> by default, but here we used 100). The uncertainty of the value of the function at the returned solution, <code class="docutils literal notranslate"><span class="pre">optimize_result['fsd']</span></code>, is the <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_error">standard error</a> of the mean.</p>
<p>If needed, the final samples used to estimate <code class="docutils literal notranslate"><span class="pre">fval</span></code> and <code class="docutils literal notranslate"><span class="pre">fsd</span></code> can be found in <code class="docutils literal notranslate"><span class="pre">optimize_result['yval_vec']</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_min</span> <span class="o">=</span> <span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="n">fval</span> <span class="o">=</span> <span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;fval&#39;</span><span class="p">]</span>
<span class="n">fsd</span> <span class="o">=</span> <span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;fsd&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BADS minimum at: x_min = </span><span class="si">{</span><span class="n">x_min</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="si">}</span><span class="s2">, fval (estimated) = </span><span class="si">{</span><span class="n">fval</span><span class="si">:</span><span class="s2">.4g</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">fsd</span><span class="si">:</span><span class="s2">.2g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total f-count: </span><span class="si">{</span><span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;func_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, time: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;total_time&#39;</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;final evaluations (shape): </span><span class="si">{</span><span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;yval_vec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BADS minimum at: x_min = [-0.0268445   0.00389814], fval (estimated) = -0.04111 +/- 0.094
total f-count: 264, time: 5.38 s
final evaluations (shape): (100,)
</pre></div>
</div>
</div>
</div>
<p>We can also check the ground-truth value of the target function at the returned point once we remove the noise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The true, noiseless value of f(x_min) is </span><span class="si">{</span><span class="n">noisy_sphere</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3g</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The true, noiseless value of f(x_min) is 0.000736.
</pre></div>
</div>
</div>
</div>
<p>Compare this to the true global minimum of the sphere function at <span class="math notranslate nohighlight">\(\textbf{x}^\star = [0,0]\)</span>, where <span class="math notranslate nohighlight">\(f^\star = 0\)</span>.</p>
<section id="remarks">
<h3>Remarks<a class="headerlink" href="#remarks" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>While PyBADS can handle noisy targets, it cannot handle arbitrarily large noise.</p></li>
<li><p>PyBADS will work best if the <em>standard deviation</em> of the objective function <span class="math notranslate nohighlight">\(\sigma\)</span>, when evaluated in the vicinity of the global solution, is small with respect to changes in the objective function itself (that is, there is a good signal-to-noise ratio). In many cases, <span class="math notranslate nohighlight">\(\sigma \approx 1\)</span> or less should work (this is the default assumption). If you approximately know the magnitude of the noise in the vicinity of the solution, you can help BADS by specifying it in advance (set <code class="docutils literal notranslate"><span class="pre">options[&quot;noise_size&quot;]</span> <span class="pre">=</span> <span class="pre">sigma_est</span></code>, where <code class="docutils literal notranslate"><span class="pre">sigma_est</span></code> is your estimate of the standard deviation).</p></li>
<li><p>If the noise around the solution is too large, PyBADS will perform poorly. In that case, we recommend to increase the precision of your computation of the objective (e.g., by drawing more Monte Carlo samples) such that <span class="math notranslate nohighlight">\(\sigma \approx 1\)</span> or even lower, as needed by your problem. Note that the noise farther away from the solution can be larger, and this is usually okay.</p></li>
<li><p>In this example, we assumed the amount of noise in each target evaluation is unknown. If instead you <em>can</em> estimate the magnitude of the noise for each evaluation, see the <a class="reference internal" href="pybads_example_4_user_provided_noise.html"><span class="doc std std-doc">next example notebook</span></a>.</p></li>
<li><p>For more information on optimizing noisy objective functions, see the BADS wiki: https://github.com/acerbilab/bads/wiki#noisy-objective-function (this link points to the MATLAB wiki, but many of the questions and answers apply to PyBADS as well).</p></li>
</ul>
</section>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="pybads_example_2_nonbox_constraints.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">PyBADS Example 2: Non-box constraints</p>
      </div>
    </a>
    <a class="right-next"
       href="pybads_example_4_user_provided_noise.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PyBADS Example 4: Noisy objective with user-provided noise estimates</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#noisy-optimization">0. Noisy optimization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-setup">1. Problem setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-optimization">2. Run the optimization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results-and-conclusions">3. Results and conclusions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remarks">Remarks</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022, Machine and Human Intelligence research group (PI: Luigi Acerbi, University of Helsinki).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>