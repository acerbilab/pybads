
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PyBADS Example 3: Noisy objective function &#8212; PyBADS</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://acerbilab.github.io/pybads/_examples/pybads_example_3_noisy_objective.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyBADS Example 4: Noisy objective with user-provided noise estimates" href="pybads_example_4_user_provided_noise.html" />
    <link rel="prev" title="PyBADS Example 2: Non-box constraints" href="pybads_example_2_nonbox_constraints.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">PyBADS</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../quickstart.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/classes/bads.html">
   BADS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/classes/optimize_result.html">
   OptimizeResult
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/advanced_docs.html">
   Advanced documentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/acquisition_functions.html">
     Acquisition Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/bads.html">
     BADS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/function_logger.html">
     FunctionLogger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/iteration_history.html">
     IterationHistory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/optimize_result.html">
     OptimizeResult
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/options.html">
     Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/parameter_transformer.html">
     VariableTransformer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/classes/timer.html">
     Timer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/functions/decorators.html">
     decorators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/functions/get_hpd.html">
     get_hpd
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/options/bads_options.html">
     BADS options
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pybads_example_1_basic_usage.html">
   PyBADS Example 1: Basic usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pybads_example_2_nonbox_constraints.html">
   PyBADS Example 2: Non-box constraints
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   PyBADS Example 3: Noisy objective function
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pybads_example_4_user_provided_noise.html">
   PyBADS Example 4: Noisy objective with user-provided noise estimates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pybads_example_5_extended_usage.html">
   PyBADS Example 5: Extended usage
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../development.html">
   Instructions for developers and contributors
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../about_us.html">
   About us
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/acerbilab/pybads/main?urlpath=lab/tree/_examples/pybads_example_3_noisy_objective.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/acerbilab/pybads/blob/main/_examples/pybads_example_3_noisy_objective.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/acerbilab/pybads"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/acerbilab/pybads/issues/new?title=Issue%20on%20page%20%2F_examples/pybads_example_3_noisy_objective.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/acerbilab/pybads/edit/main/_examples/pybads_example_3_noisy_objective.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/_examples/pybads_example_3_noisy_objective.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#noisy-optimization">
   0. Noisy optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-setup">
   1. Problem setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-optimization">
   2. Run the optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-and-conclusions">
   3. Results and conclusions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#remarks">
     Remarks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-3-full-code">
   Example 3: Full code
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>PyBADS Example 3: Noisy objective function</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#noisy-optimization">
   0. Noisy optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-setup">
   1. Problem setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-optimization">
   2. Run the optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results-and-conclusions">
   3. Results and conclusions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#remarks">
     Remarks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-3-full-code">
   Example 3: Full code
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="pybads-example-3-noisy-objective-function">
<h1>PyBADS Example 3: Noisy objective function<a class="headerlink" href="#pybads-example-3-noisy-objective-function" title="Permalink to this headline">#</a></h1>
<p>In this example, we will show how to run PyBADS on a noisy target.</p>
<p>This notebook is Part 3 of a series of notebooks in which we present various example usages for BADS with the PyBADS package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pybads</span> <span class="kn">import</span> <span class="n">BADS</span>
</pre></div>
</div>
</div>
</div>
<section id="noisy-optimization">
<h2>0. Noisy optimization<a class="headerlink" href="#noisy-optimization" title="Permalink to this headline">#</a></h2>
<p>PyBADS is able to optimize also <em>noisy</em> objective functions. A noisy (or stochastic) objective function is an objective that will return different results if evaluated twice at the same point <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>. Conversely, a non-noisy objective function is known as noiseless or deterministic. For example, noisy objectives are common in model fitting when the model is evaluated through simulation (e.g., via sampling aka Monte Carlo methods).</p>
<p>For a noisy objective, PyBADS attempts to minimize the <em>expected value</em> of <span class="math notranslate nohighlight">\(f(\mathbf{x})\)</span>,
$<span class="math notranslate nohighlight">\(
\mathbf{x}^\star = \arg\min_{\mathbf{x} \in \mathcal{X} \subseteq \mathbb{R}^D} \mathbb{E}\left[f(\mathbf{x})\right].
\)</span>$</p>
</section>
<section id="problem-setup">
<h2>1. Problem setup<a class="headerlink" href="#problem-setup" title="Permalink to this headline">#</a></h2>
<p>For this example, we take as target a quadratic function and we add i.i.d. Gaussian noise to it (<em>noisy sphere</em>). In a real case, the noise would arise from some stochastic process in the calculation of the target.</p>
<p>We also set here several <code class="docutils literal notranslate"><span class="pre">options</span></code> for the optimization:</p>
<ul class="simple">
<li><p>We tell <code class="docutils literal notranslate"><span class="pre">bads</span></code> that the target is noisy by activating the <code class="docutils literal notranslate"><span class="pre">uncertainty_handling</span></code> option. This is not strictly needed, as <code class="docutils literal notranslate"><span class="pre">bads</span></code> can automatically detect if a target is noisy, but it is good practice to specify.</p></li>
<li><p>We also limit the number of function evaluations with <code class="docutils literal notranslate"><span class="pre">max_fun_evals</span></code>, knowing that this is a simple example. Generally, <code class="docutils literal notranslate"><span class="pre">bads</span></code> will tend to run for longer on noisy problems to better explore the noisy landscape.</p></li>
<li><p>Finally, we tell <code class="docutils literal notranslate"><span class="pre">bads</span></code> to re-evaluate the target at the returned solution with 100 samples via <code class="docutils literal notranslate"><span class="pre">noise_final_samples</span></code> (by default, <code class="docutils literal notranslate"><span class="pre">noise_final_samples</span> <span class="pre">=</span> <span class="pre">10</span></code>, but since our function is inexpensive we can use more evaluations). These evaluations count towards the total budget of function evaluations <code class="docutils literal notranslate"><span class="pre">max_fun_evals</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">noisy_sphere</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple quadratic function with added noise.&quot;&quot;&quot;</span>
    <span class="n">x_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_2d</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">x_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">f</span> <span class="o">+</span> <span class="n">noise</span>

<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]);</span>      <span class="c1"># Starting point</span>
<span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">])</span>       <span class="c1"># Lower bounds</span>
<span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>         <span class="c1"># Upper bounds</span>
<span class="n">plb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>      <span class="c1"># Plausible lower bounds</span>
<span class="n">pub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>        <span class="c1"># Plausible upper bounds</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;uncertainty_handling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;max_fun_evals&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="s2">&quot;noise_final_samples&quot;</span><span class="p">:</span> <span class="mi">100</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-the-optimization">
<h2>2. Run the optimization<a class="headerlink" href="#run-the-optimization" title="Permalink to this headline">#</a></h2>
<p>We run <code class="docutils literal notranslate"><span class="pre">bads</span></code> with the user-defined <code class="docutils literal notranslate"><span class="pre">options</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bads</span> <span class="o">=</span> <span class="n">BADS</span><span class="p">(</span><span class="n">noisy_sphere</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">plb</span><span class="p">,</span> <span class="n">pub</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
<span class="n">optimize_result</span> <span class="o">=</span> <span class="n">bads</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Beginning optimization of a STOCHASTIC objective function

 Iteration    f-count      E[f(x)]        SD[f(x)]           MeshScale          Method              Actions
     0           1         20.5617             nan               1                                  
     0          33        -1.22191             nan               1          Initial mesh            Initial points
     0          37        -1.22191               1             0.5          Refine grid             Train
     1          45        -1.22191               1            0.25          Refine grid             Train
     2          53       -0.435447        0.279863           0.125          Refine grid             Train
     3          54      -0.0421095        0.212522           0.125      Incremental search (ES-ell)        
     3          55      -0.0520148        0.205262           0.125      Incremental search (ES-ell)        
     3          61      -0.0520148        0.205262          0.0625          Refine grid             
     4          69      -0.0190601        0.172788         0.03125          Refine grid             Train
     5          70       0.0155653        0.153169         0.03125      Successful search (ES-ell)        
     5          72     -0.00509212        0.148866         0.03125      Successful search (ES-ell)        
     5          75     -0.00994359        0.143169         0.03125      Incremental search (ES-ell)        
     5          81     -0.00994359        0.143169        0.015625          Refine grid             Train
     6          89       0.0461287        0.133138      0.00390625          Refine grid             Train
     7          97       0.0685939        0.115893       0.0078125        Successful poll           Train
     8          98       0.0606537        0.113455       0.0078125      Successful search (ES-wcm)        
     8         100       0.0543558        0.109812       0.0078125      Successful search (ES-wcm)        
     8         102       0.0495223        0.108131       0.0078125      Successful search (ES-ell)        
     8         112       0.0476534        0.105235        0.015625        Successful poll           Train
     9         113       0.0415597        0.101935        0.015625      Successful search (ES-wcm)        
     9         115       0.0360151        0.100619        0.015625      Successful search (ES-ell)        
     9         117       0.0286623       0.0994139        0.015625      Successful search (ES-ell)        
     9         128       0.0107932       0.0955954         0.03125        Successful poll           
    10         129       0.0302242        0.100893         0.03125      Successful search (ES-ell)        
    10         140       0.0241649       0.0943882          0.0625        Successful poll           
    11         148        0.022237       0.0879658        0.015625          Refine grid             Train
    12         155       0.0341453       0.0842745         0.03125        Successful poll           Train
Optimization terminated: change in the function value less than options.TolFun.
Estimated function value at minimum: 0.13138157013731047 ± 0.10476143847907263 (mean ± SEM from 100 samples)
</pre></div>
</div>
</div>
</div>
</section>
<section id="results-and-conclusions">
<h2>3. Results and conclusions<a class="headerlink" href="#results-and-conclusions" title="Permalink to this headline">#</a></h2>
<p>First, note that in this case <code class="docutils literal notranslate"><span class="pre">optimize_result['fval']</span></code> is the <em>estimated</em> function value at <code class="docutils literal notranslate"><span class="pre">optimize_result['x']</span></code>, obtained by taking the mean of <code class="docutils literal notranslate"><span class="pre">options['noise_final_samples']</span></code> target evaluations (<code class="docutils literal notranslate"><span class="pre">noise_final_samples</span> <span class="pre">=</span> <span class="pre">10</span></code> by default, but here we used 100). The uncertainty of the value of the function at the returned solution, <code class="docutils literal notranslate"><span class="pre">optimize_result['fsd']</span></code>, is the <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_error">standard error</a> of the mean.</p>
<p>If needed, the final samples used to estimate <code class="docutils literal notranslate"><span class="pre">fval</span></code> and <code class="docutils literal notranslate"><span class="pre">fsd</span></code> can be found in <code class="docutils literal notranslate"><span class="pre">optimize_result['yval_vec']</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_min</span> <span class="o">=</span> <span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="n">fval</span> <span class="o">=</span> <span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;fval&#39;</span><span class="p">]</span>
<span class="n">fsd</span> <span class="o">=</span> <span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;fsd&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BADS minimum at: x_min = </span><span class="si">{</span><span class="n">x_min</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="si">}</span><span class="s2">, fval (estimated) = </span><span class="si">{</span><span class="n">fval</span><span class="si">:</span><span class="s2">.4g</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">fsd</span><span class="si">:</span><span class="s2">.2g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total f-count: </span><span class="si">{</span><span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;func_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, time: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;total_time&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> s&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;final evaluations (shape): </span><span class="si">{</span><span class="n">optimize_result</span><span class="p">[</span><span class="s1">&#39;yval_vec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BADS minimum at: x_min = [-0.03988647  0.17327881], fval (estimated) = 0.1314 +/- 0.1
total f-count: 256, time: 23.14 s
final evaluations (shape): (100,)
</pre></div>
</div>
</div>
</div>
<p>We can also check the ground-truth value of the target function at the returned point once we remove the noise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The true, noiseless value of f(x_min) is </span><span class="si">{</span><span class="n">noisy_sphere</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3g</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The true, noiseless value of f(x_min) is 0.0316.
</pre></div>
</div>
</div>
</div>
<p>Compare this to the true global minimum of the sphere function at <span class="math notranslate nohighlight">\(\textbf{x}^\star = [0,0]\)</span>, where <span class="math notranslate nohighlight">\(f^\star = 0\)</span>.</p>
<section id="remarks">
<h3>Remarks<a class="headerlink" href="#remarks" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>While PyBADS can handle noisy targets, it cannot handle arbitrarily large noise.</p></li>
<li><p>PyBADS will work best if the <em>standard deviation</em> of the objective function <span class="math notranslate nohighlight">\(\sigma\)</span>, when evaluated in the vicinity of the global solution, is small with respect to changes in the objective function itself (that is, there is a good signal-to-noise ratio). In many cases, <span class="math notranslate nohighlight">\(\sigma \approx 1\)</span> or less should work (this is the default assumption). If you approximately know the magnitude of the noise in the vicinity of the solution, you can help BADS by specifying it in advance (set <code class="docutils literal notranslate"><span class="pre">options[&quot;noise_size&quot;]</span> <span class="pre">=</span> <span class="pre">sigma_est</span></code>, where <code class="docutils literal notranslate"><span class="pre">sigma_est</span></code> is your estimate of the standard deviation).</p></li>
<li><p>If the noise around the solution is too large, PyBADS will perform poorly. In that case, we recommend to increase the precision of your computation of the objective (e.g., by drawing more Monte Carlo samples) such that <span class="math notranslate nohighlight">\(\sigma \approx 1\)</span> or even lower, as needed by your problem. Note that the noise farther away from the solution can be larger, and this is usually okay.</p></li>
<li><p>In this example, we assumed the amount of noise in each target evaluation is unknown. If instead you <em>can</em> estimate the magnitude of the noise for each evaluation, see the <a class="reference internal" href="pybads_example_4_user_provided_noise.html"><span class="doc std std-doc">next example notebook</span></a>.</p></li>
<li><p>For more information on optimizing noisy objective functions, see the BADS wiki: https://github.com/acerbilab/bads/wiki#noisy-objective-function (this link points to the MATLAB wiki, but many of the questions and answers apply to PyBADS as well).</p></li>
</ul>
</section>
</section>
<section id="example-3-full-code">
<h2>Example 3: Full code<a class="headerlink" href="#example-3-full-code" title="Permalink to this headline">#</a></h2>
<p>See <a class="reference download internal" download="" href="../_downloads/e438e0f5fc735fbcda36ef39de78ec93/pybads_example_3_noisy_objective.py"><span class="xref download myst">here</span></a> for a Python file with the code used in this example, with no extra fluff.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="pybads_example_2_nonbox_constraints.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">PyBADS Example 2: Non-box constraints</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pybads_example_4_user_provided_noise.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PyBADS Example 4: Noisy objective with user-provided noise estimates</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2022, Machine and Human Intelligence research group (PI: Luigi Acerbi, University of Helsinki).<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>